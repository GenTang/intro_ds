计算机应用研究
APPLICATION RESEARCH OF COMPUTERS
2000　Vol.17　No.2　P.45-47



基于Java的VoD系统研究与设计
戴海平　夏雨人
摘 要 描述了基于Java实现的一个视频点播系统。基于数字影音协会(DAVIC)的客户/服务器系统主要包括一个视频服务器和一个机顶盒客户端，重点介绍了该系统的客户端应用的实现方法，该系统在遵照DAVIC规范的同时，通过基于Java的实现提高了软件的模块化程度，实现了瘦客户机模型，同时允许VoD服务与Internet环境的集成。
关键词 视频点播 Java 机顶盒 DAVIC DSM-CC
　　视频点播(VoD，Video on Demand)允许用户对视频信息进行选择，用户坐在家里就可以选择自己想看的电视节目，就像看录影带或VCD一样方便。视频点播是交互式视频的主要内容之一，具有良好的经济效益、社会效益和广阔的前景，除了可以让用户选择自己喜欢的电影、电视和新闻，它还可以发展成为可视电话、远程教学、远程医疗以及交互式游戏等多种服务。
　　Java这一网络环境下的编程语言，相对传统语言有许多优势，实现了平台独立性，即Java应用程序可以在各种系统平台上运行，一次编写，到处执行，在很大程度上减少了软件升级与维护的工作量，降低了系统的开发成本。Java的前身Oak原意是解决多种电子器件的统一接口问题，随着Java的发展，它的这一功能进一步增强，Java应用于视频点播系统将带来很大的方便和好处。
1 视频点播系统模型
　　数字影音协会(Digital Audio-Video Council，DAVIC)是一个开发数字视频应用协议的国际联盟，从1994年成立至今，一直致力于数字交互视频应用标准的制定工作，1998年3月发布的DAVIC1.3.1已经成为ISO/IEC JTC1标准的一部分。
　　DAVIC为包括VoD在内的交互式服务确定了一个框架。如图1所示，系统是按照参考点和信息流来描述的。这个模型包括节目提供系统(Content Provider System-CPS)、服务提供系统(Service Provider System-SPS)和服务使用系统(Service Consumer System-SCS)，它们之间通过传输系统相连接。对于我们这个简化的VoD系统，CPS与SPS合二为一对应于视频服务器，而SCS则对应于机顶设备(Set Top Unit-STU)。在服务器与机顶设备之间定义了若干参考点(如A1与A9)和信息流(如S1到S4)。信息流实现了连接和会话的建立、断开(S3/S4)，以及控制信息(S2)和数据(S1)的交换，信息流的实现是基于DSM-CC(Digital Storage Media-Command and Control 数字存储媒体-命令与控制)协议。

图1　通用DAVIC模型
　　通过DSM-CC用户-网络连接建立了初始连接和配置(通过信息流S3与S4)之后，DSM-CC用户-用户连接协议栈能够通过S2信息流进行可靠的控制信息交换。VoD应用程序利用DSM-CC用户-用户协议提供的服务从服务器获取信息以供STU使用。这些服务包括会话、文件和目录服务。这些服务允许VoD应用程序建立一个会话，浏览目录和从服务区上获取文件。这些文件本身可以被VoD应用程序使用(例如包含用户界面的图象和位图)。
　　信息流S1用来传输MPEG2数据。当用户选择了观看某一部电影时，S1连接在STU和VoD服务器之间建立。STU中的多路复接/解码设备处理收到的数据并向用户显示。
2 基于Java的VoD系统
　　Java这一网络环境下的编程语言，刚一问世就吸引了众人的目光，给开发人员带来了无限的希望，现已成为计算机界最热门的课题之一。Java语言有许多优势，实现了平台独立性，在很大程度上减少了软件升级与维护的工作量，降低了系统的开发运行成本。
　　所谓Java并不仅仅是一种计算机语言，它包括了如下的组成部分：Java语言、Java虚拟机(Virtual Machine)、Java基本应用程序接口(Base API)和Java标准延伸接口(Standard Extension API)。Java源程序经过编译后产生Java字节码(Byte Code)，字节码不随操作系统的改变而改变，可以被不同操作系统下的虚拟机解释，实现了Java多平台下运行的兼容性。一种平台下开发的Java程序，可以在多种平台下的虚拟机中运行，而无需像C++那样需要针对不同的平台对源程序进行修改，运行重新编译、连接。
　　从Java的这一特点中，不难理解为什么互联网络对Java的成功具有如此重要的意义：只有Java可以在互联网络的多平台下运行。Java的成功大大增强了互联网络的交互性。作为一种网络开发系统，Java具有很宽广的应用范围和领域。今天，嵌入式Java已成为现实，在与网络有关的应用中应用得更是广泛。Java的分布式作业机制(Distributed Computing Architecture)使Java不仅可在多平台下运行，而且可以与多种语言接口。
　　点播视频服务器由一个服务器目录结构组成，它包括视频信息流、实现用户菜单和界面的Java对象以及界面中用到的位图和图象文件。用户将它们的STU连接到服务器的途径有两种：使用Internet浏览器(同时启动一个小程序)或是通过一个小型的专用Java程序(可以用DSM-CC的下载协议来实现)来获取初始的应用程序，这一过程称为初始化。获取的这个程序可以让用户通过DSM-CC的会话服务连上一个VoD服务器并借助于文件和目录服务得到真正的VoD应用程序。
　　如图2中深色部分所示，我们的VoD程序建立在DSM-CC的用户-用户服务之上。上半部分包括两个组件：一个是建立初始连接的静态初始化组件(Init)；一个是实际的VoD程序(Program)。请注意在会话开始之前只有初始化组件驻留在客户端。实现用户菜单的VoD程序是从服务器动态下载的，这允许服务提供者修改程序而不对客户端进行任何改动。

图2　VoD应用结构
　　初始化完成后，从服务器下载的VoD程序在客户端开始执行，并实现用户界面和与服务器之间的信息交换。当用户从屏幕菜单中选择了观看某一部电影时，一个DSM-CC的流服务的连接在STU和VoD服务器之间建立，用来传输视频数据(如MPEG2)，STU中的解码设备处理收到的数据并向用户显示。
　　应用层中的会话组件为初始化提供了连接和断开的功能。这些功能被直接映射到DSM-CC用户-用户协议会话的调用。装载程序实现了文件获取功能，对类和数据一样适用：类从服务器上下载后动态地加入到运行环境中，位图和图象等数据文件下载后供程序使用。装载程序通过文件服务获取被请求的信息，同时通过目录服务打开和关闭服务器上的目录，并控制一个流的流界面直接位于流服务之上。
　　VoD程序的用户界面模块由一些Java对象来实现，Java包含了一套强大的图形界面类库，可在不同平台上实现相同的图形界面。在Java图形类库的基础上，可实现一系列基本组件，VoD程序通过组合不同的基本组件，实现各种各样的用户界面。
　　VoD程序执行时，首先通过得到一个位于缺省服务器上VODManager对象，VODManager对象提供给用户服务器上现有服务对象的列表，经用户选择之后得到相应的VODServer对象。VODServer对象可能位于网络的任何位置，它向用户提供导航和控制的菜单(通过调用GetPrograms方法)，一个简单菜单的例子向用户展示服务器上的电影列表，用户从中作出选择，当用户选择了节目之后，将通过VODServer对象建立一个DSM-CC的流服务的连接，来将视频数据流传输至浏览器或STU。
　　访问VoD服务器有两种途径：通过Web浏览器或机顶设备(STU-Set Top Unit)。若通过前者只需简单地选择这个VoD服务器的网页就行了，一个从网页中执行的小程序将同基于DAVIC的VoD服务器建立S2控制连接。如果使用的STU不具备Internet访问能力，而是一个DAVIC兼容的STU，STU直接与VoD服务器建立S2控制连接。在这两种情况下，S2连接建立之后，再进行下面的读文件和目录打开/定位操作已从VoD服务器上获取实际的VoD程序－包括Java字节码和图象。
　　新的电影或节目可以通过Internet(如ftp)或DSM-CC协议添加到服务器上。只要添加一些Java代码就可令新电影出现在VoD菜单上，提供给用户电影的详细信息。
3 系统的实现
　　视频点播的主要媒介之一便是有线电视网。在我国广播电视网有其独特的优势，其一是覆盖面广、普及率高。至1997年底，入网户数达到7,000万户，且每年以1,000万户的速度递增，有线电视网络成为入户率最高的信息网络。有线电视网的另一个优势是入户频带宽，适合于提供宽带功能业务，其数据传输速率是现在公共电话网的百倍以上。因此我国当前十分适合于发展基于有线电视网的视频点播应用，相信在不远的将来数字视频服务将成为主要的市场份额之一。
　　机顶盒作为视频点播系统的关键部分，是一个嵌入式的网络用户设备，它的设计是实现交互视频的关键环节之一。它处于电视(或电脑)与数字视频网络之间，功能包括网络连接，视频解码和提供一个可交互执行的软件。一个机顶盒将包括CPU、网络接口设备、视/音频解码与输出和其它一些部件，目前IDT、MIPS以及SUN等公司都将向机顶盒提供自己的芯片，来争夺这一市场的份额。我们在设计中面临的主要矛盾是：用户对网络应用要求正日趋多样化和不断地增长；而机顶盒作为应用装置，又必须考虑其实用性、可行性和经济性。在机顶盒设计过程中，我们必须考虑的几个主要问题是：
　　首先，机顶盒作为一种专用设备，其对OS的要求有其特殊性，只要能运行其应用软件就可以了。相比之下，Java OS就是一个很好的选择。Java的平台无关性使得编写的应用程序不限制于一定的硬件平台，只要机顶盒芯片能够运行Java程序即可。
　　其次，由于网络信息服务的多样性，不可能在一个小小的机顶盒里集成所有的应用，即使能做到，网络应用的迅速变化也不允许这样做。也就是说，机顶盒所提供的服务必须是支持动态更新的。使用Java不但能解决服务种类的多样性以及服务频繁更新的问题，同时由于减少了应用程序在机顶盒中的驻留，实现了瘦客户机结构，也使得机顶盒设备的复杂程度大大降低。
　　最后，可能也是最重要的一点，Java使得点播电视与Internet服务的集成成为可能。这样，机顶盒除了访问专门的视频服务器之外，还能通过有线电视网络访问Internet。
　　用Java开发的机顶盒将提供一个支持下载小应用程序(Applet)的交互式软件执行环境。用户界面和具体服务并不需要存放在机顶盒中，驻留在客户端的只是一段初始化程序，机顶盒按需要下载不同的小应用程序来完成多样化的功能。这样，当服务商更改它们的服务内容时，只要修改服务器上的服务对象就行了，用户的机顶盒程序不需作任何改变。
　　用户所得到的服务由它们所下载的小程序决定，而实现点播视频的小程序与其它服务对象(如可提供Internet接入的)并无本质的区别，因此Internet和点播视频服务之间可以做到无缝集成。例如在网络购物服务中，销售商的应用程序下载到顾客家中来帮助他们完成挑选与付款的过程。
　　在使用Java的种种优势和方便的同时，其自身的局限性也是我们必须考虑的。作为一种解释性语言，Java执行速度和效率的问题是客观存在的，如何保证系统的实时性，是设计过程中要重点考虑的。在系统实现中，将采取各种技术使系统的实时性来得更好，如点播视频服务中计算量最大的视频解码任务，将由专门的硬件完成，同时即时编译器(Just In Time Compiler)的运用也将提高Java的运行速度。
4 结束语
　　本文描述了基于Java实现的一个视频点播应用。基于数字影音协会(DAVIC)的客户/服务器系统主要包括一个视频服务器和一个机顶盒客户端，本文主要介绍了这个系统的客户端应用的实现。这个系统在遵照DAVIC规范的同时，也实现了允许DAVIC服务与Internet环境的集成。
　　采用基于Java体系的实现VoD应用带来了一些好处。首先是Java的平台无关性使得应用软件可在二进制代码级实现重用，提高了软件的模块化程度；其次是用Java/CORBA实现允许向运行环境动态添加对象，实现了客户端应用程序与具体服务无关，让客户端可随时反映出服务器的最新信息，降低了对STU的资源要求，实现了瘦客户端模型；最后，同时也许是最重要的一点，还提供了一种途径将DAVIC服务与当前十分热门并还在不断扩展的Internet集成。
戴海平（上海交通大学计算机科学与工程系 上海 200030）
夏雨人（上海交通大学计算机科学与工程系 上海 200030）
参考文献
1，Digital Audio-Visual Council, DAVIC 1.4 Specification, Sep.1998
2，CORBA 2.0 the Common Object Request Broker: Architecture and Specification. Revision 2.0, Object Management Group(OMG), July l995
3，Information Technology-Generic Coding of Moving Pictures and Associated Audio:Digital Storage Media Command and Control-ISO/IEC 13818-6 International Standard, ISO/IEC JTC1/SC29/WG11 MPEG96/N1300p1, July l996
4，Peter Varhol, Java in Embedded-systems Design, Computer Design, March 1997: p63
5，AIex De Jong, Karen Hsing and David Su. A VoD Application Implemented in Java, Multimedia Tools and Application. V5 n2 Sep l997: p161
6，Kiyoshi Kohiyama, et al. Architecture of MPEG-2 Digital Set-top-box for CATV VoD System, IEEE Transactions on Consumer Electronics, V42 Aug l996: p667
7，Peter Varhol, Designing Components for Set-top Boxes. Computer Design, Aug 1997: p90
8，Winston William Hodge著, 钟玉琢,乔秉新等译. 交互式电视技术多媒体技术综合指南. 北京: 电子工业出版社, 1996年3月
9，Suleiman"Sam" Lalni, Kris Jamsa, Ph.D.著, 扬武杰等译. Java编程与实例. 北京: 电子工业出版社, 1997年6月
收稿日期：1999年7月26日
