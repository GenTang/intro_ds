计算机应用研究
APPLICATION RESERCH OF COMPUTERS
2000  Vol.17　No.1　P.6-8




通用串行总线及其应用
王省书 秦石乔 邵福球
摘 要 随着通用串行总线(USB)的接口集成到PC主板上及Windows 98等操作系统全面支持USB技术标准，USB的应用正得到突飞猛进的发展。介绍了目前在进行PC机功能扩展时存在的问题、USB的性能、发展趋势及USB在计算机外设、虚拟仪器和工业测控领域中的应用。
关键词 通用串行总线 USB设备 虚拟仪器 测控系统
1　引言
　　信息革命是本世纪末期的主要特征，PC在信息革命中起到推波助澜的作用。PC外设的日益丰富，扩展了PC的应用范围。PC在军事、工业生产、教学科研和日常生活中的应用日益普及和深入，因PC本身只提供高性能的运算处理等方面的基本能力，当我们将一台PC应用于某个具体实际需要时，往往面临着对PC基本功能进行扩展的难题。在对PC进行功能扩展时，原则上每一个外设必须插在一个接口上，如果所有的接口均被用上了就只能通过添加插卡来追加接口了，当然机器内部可增插卡的数量还受到计算机上插槽个数的限制，多功能卡的出现以及有些厂家针对自己的产品线开发的自家适用的通用接口，在很大程度上是为了解决多种设备连接到主机及提高传输速率而出现的解决方案。由于PC的标准接口有限，因此目前对PC进行功能扩展的一种常用方法是通过增加功能接口插卡来实现，但扩展时必须对计算机很熟悉，且需对接口卡的硬件资源(I/O地址、内存、中断、DMA)进行合理的配置等，扩展难度大。
　　为了解决功能扩展接口插卡最头痛的配置问题，九十年代中期推出了即插即用接口卡标准(PCI和ISA PnP)，由即插即用BIOS和即插即用操作系统完成对接口卡资源的自动配置，使功能扩展接口卡的使用变得简单方便。但扩展接口卡仍存在以下问题：第一、接口卡的插拔过程必须停机，并且需打开PC机箱进行安装和拆卸，这个过程仍需要一定层次的技术支持，即插即用技术的采用只是降低了功能扩展卡的技术需要程度，这对PC这样广泛应用的工具而言仍显不足；第二、接口插卡设备驱动程序的安装、调试直至正常运行的过程仍旧需要各种技术的支持，特别是接口插卡作为一种硬件设备插入PC后，总是要占用PC的各种硬件资源，即插即用算法虽能解决绝大部分的资源配置，但不能保证是100%解决，因此，其安装和配置过程仍需要人工干预。而当扩展插卡较多时，常会出现一块或多块插卡因无法合理配置而不能正常工作的情况，严重时可导致系统崩溃；第三、接口插卡的质量高低、兼容性和标准性的程度以及驱动软件的可靠性将直接影响计算机的寿命和系统的稳定性、可靠性；第四、对象笔记本电脑之类的小体积PC很难用接口插卡进行功能扩展；第五、PC插槽中的各种接口卡受到PC内部强的射频辐射干扰，使其性能受到很大影响，除非接口卡是全数字化的。
　　那么当把外设连接到PC上对其进行功能扩展时，能不能简单到用户只需拿起外设的接线，把插线插入接口中就行了呢？
　　1994年Intel、Compaq、Digital、IBM、Microsoft、NEC、Northern-Telecom这些世界上著名的计算机公司和通讯公司成立了USB论坛，于1996年1月推出了USB 1.0通用串行总线(Universal Serial Bus)规范，1997年开始有真正符合USB技术标准的外设出现。USB 1.1是目前推出的支持USB的计算机与外设上普遍采用的标准。在1999年2月23日的Intel开发者论坛大会上，介绍了USB 2.0规范。USB 2.0将向下兼容USB 1.1，数据的传输率将达到120 Mbps~240 Mbps，预备支持宽带宽数字摄像设备及下一代扫描仪、打印机及存储设备。预计明年下半年将会出现符合USB 2.0规范的系统和外设。在Microsoft公司与Intel公司推出的PC'99的硬件体系规范和PC'99的软件规范都包括对USB的支持。APPLE公司的MAC OS及Microsoft公司1998年6月发布的Windows 98、1998年11月发布的Windows CE全面支持USB技术标准，未来的Windows 2000中也将全面支持USB。目前国际市场上销售的最新型的计算机一般都带有两个USB端口。
　　USB技术的提出是基于采用通用连接技术实现外设的简单快速连接，达到方便用户、降低成本、扩展PC机连接外设的范围之目的，使PC的功能扩展变得非常简单方便，并且能最大限度地降低用户对计算机技术的需求，使所有的外设均成为所谓的傻瓜式的设备。USB技术具有开放性，是非赢利性的规范，得到了广泛的工业支持，在数字图象、电话语音合成、交互式多媒体、消费电子产品等应用领域得到了广泛的应用。可以预见USB将成为今后PC应用的主流和发展的必由之路。
2　USB概述
　　USB系统由USB主机(Host)、集线器(HUB)、连接电缆、USB外设组成。USB设备的具体连接方式如图1所示。

图1　USB设备的连接方式
　　集线器(HUB)是为多个USB外设提供接口的，它以主仆的方式实施外设的管理。集线器可由自己提供电源或从主机获得电源。通过USB集线器，USB端口非常容易扩展，真正实现多个外设共用一个接口。
　　USB技术的应用是计算机外设连接技术的重大变革。USB接口标准属于中低速的传输界面，面向家庭与小型办公领域的中低速设备，比如键盘，鼠标、游戏杆、显示器、数字音箱、数字相机以及Modem等，目的是在统一的USB接口上实现中低速外设的通用连接。USB的定义借助了目前所有成熟的网络技术，并在此基础上进行了合理的简化，以达到简单实用的目的和最佳的性能价格比。USB是一种同步串行半双工传输总线，目前的数据传输率最高达12Mbps，比标准串口快100倍，比并口快10倍，可用于更多的新型设备，并可很好地满足视频图象的实时传输要求；采用差分传输方式，具有很好的传输可靠性。与扩展插卡相比，USB设备不占用PC的硬件资源(如I/O地址、内存、中断、DMA等)，设备的控制、管理和信息交换完全是由系统软件按USB协议进行传输，因此，具有更高的可靠性和兼容性，不存在因设备占用资源冲突而导致系统的紊乱的问题。为适应外设的多样性，USB提供了四种数据传送类型：控制、中断、同步和块传输。USB的所有信息按包传送，具有满足设备各种控制管理和数据传输的多种信息包格式，包中的数据有效载荷可达1024字节。USB允许系统自动地优化外设间的数据传输，可以对未经压缩的数字图象进行实时传送，也可以实现主机与外设及消费电子产品与外设间(像数码相机与打印机间)的直接数据传送。
　　理论上一个USB接口可以雏菊链的方式连接127种外设。当外设的电源要求为5V且电流小于500mA时，可直接从USB总线获取电源，这样USB设备就不再需要专门的电源线，可以降低设备的成本且减少了连线的烦琐程度。USB允许外部设备的快速连接，在不用关闭计算机的情况下真正支持即插即用，即USB设备的插拔可以在PC正常工作条件下进行。在USB系统中，设备的插拔由与之相连的Hub自动检测出来，随后告之主机总线上的设备的变化情况。如果一旦有新设备连接到集线器上，主机通过像Windows 98或MAC OS操作系统的即插即用特性，自动去搜索识别所连接的外设并按其要求进行自动配置，操作系统将自动分配新增外设所需要的资源，包括软件的驱动及所需的带宽，使其能正常工作；若是设备拆除，系统软件将收回已分配给该设备的USB资源，自动卸载相应的驱动程序。这种带电插拔的即插即用功能目前仅USB设备独有，使USB设备的应用非常简单、方便，降低了设备成本与使用过程中技术支持与服务的成本，使缩小主机系统的空间成为可能。USB使增加外设的整个过程自动化，避免了目前在PC机上每增加硬件设备都需要打开机箱插入新卡、重新设置、重新启动的麻烦。
　　正是由于USB上述突出的优点，USB设备不仅在计算机外设的扩展方面有广泛应用前景，而且将在工业控制系统、虚拟仪器方面有着重要的发展潜力。
3　USB的应用
3.1　计算机外设
　　USB正在吸引众多的外设制造商，在1998 Comdex/Fall'98大会上Intel公司演示的一台计算机实际连接外设111个，创造了个人计算机连接外设的最高记录，虽然实际使用过程中一台PC机不太可能连接111个外设，但根据USB论坛预测一般用户在使用过程中还是需要连接6到8个外设。
　　USB是新一代商用和家庭用PC外设的使能技术。USB技术将为商业和家庭用户转换PC功能使之进入一个通用信息、通信和娱乐应用领域。除了已有的外设可用USB实现外，USB技术还在下面几个方面拓展了PC的应用范围。
3.1.1 扩展商业PC的功能
　　。CTI(Computer Telephony Integration)设备
　　　声音邮件
　　　集成通信
　　　带注释的E-mail
　　　呼叫者识别(Caller ID)
　　　Internet和Web开发
　　　视频压缩和POTS电话会议
　　。安全设备
　　　ID卡阅读器
　　　数字加密设备
　　。图象和桌面出版设备
　　　限定范围的数字相机
　　　个人扫描仪
　　　专用打印机
3.1.2 为家用PC增加新的功能
　　。多用户游戏
　　。数字游戏杆
　　。Internet设备
　　。相片扫描仪和限定范围的数字相机
　　。数字音频设备，MIDI接口外设
　　目前，USB设备的发展势头正如日中天，国外已推出了上百种USB外设，包括USB集线器、打印机、扫描仪、存储器、数字音箱、数字相机和MODEM等等。USB设备在国外的实际应用中已经开始逐渐取代传统外设，在国内还处于逐渐被接受的时期。1999年年初我们已感到USB设备进入我国市场的强劲之势，不论是外设还是主机，都有产品推出。1999年3月9日，联想公司通过Internet进行其东芝笔记本电脑新品的新闻就是用了USB端口摄像头。但国内市场的USB产品，品种并不多。随着USB技术的普及应用和PC应用范围的拓展，USB外设特别是利用了USB技术的消费电子产品将是一个潜力巨大的市场。
3.2　USB总线虚拟仪器和测控系统
　　所谓虚拟仪器，是指一种具有某种测量仪器功能的设备，但其完整的仪器功能的实现必须与计算机软硬件紧密结合才能完成。目前的虚拟仪器有两类：一类是PC总线虚拟仪器，特定的仪器功能制作在一块扩展接口插卡上，将其插入计算机的扩充插槽中，在计算机的软硬件支持下工作。这类虚拟仪器除具有一般插卡的缺点之外，还存在两个显著缺点：一是配置复杂，非专业人员不能进行安装，这样极大地限制了这类虚拟仪器的推广应用；二是测量信号直接进入计算机，各种现场的被测信号对计算机的安全造成很大的威胁，同时计算机内部的强电磁干扰对被测信号也会造成很大的影响。另一类是外挂式虚拟仪器，它既具有PC总线虚拟仪器的优点，同时又克服了PC总线虚拟仪器的缺点，这是虚拟仪器发展的一个理想方向。外挂式虚拟仪器国内目前还没有报道，国外主要是美国的虚拟仪器实验室于1996年底推出的基于双向并口(IEEE-1284打印机并口)的外挂式虚拟仪器。
　　计算机集中测控系统主要是以PC为主并通过PC总线测量接口卡和控制接口卡构成的测控系统。其中测量环节可以看成是专用的虚拟测量仪器，因此测控系统与虚拟仪器相比主要是多了一个闭环控制环节，即PC总线的输出接口模块和相应的控制软件，主要是开关量控制和DA输出模拟量控制两大类模块。
　　USB本身是一种工业级总线标准，其可靠性等级可很好地满足现场工业测量控制系统的要求。根据虚拟仪器及USB总线的特点，将二者结合起来构成外挂式USB总线虚拟仪器是一种理想的选择。虽然外挂式打印机并口虚拟仪器较好地解决了PC总线虚拟仪器的缺点，但并口上多个设备的扩展不太方便，且成本高。而USB总线从速度性能方面而言与IEEE-1284打印机并口相差无几，只比ISA总线略低。因此，用USB总线构成外挂式虚拟仪器的速度性能可与IEEE-1284持平，比PC总线虚拟仪器要略低，但可很好满足如高速数字存储示波器的实时显示和处理要求，也就是说能满足各种虚拟仪器的速度要求。USB总线的设备扩展非常方便，最多可支持由127台设备构成的大型测量系统，而成本只比ISA总线虚拟仪器略高，与PCI总线虚拟仪器可基本持平。除此之外，外挂式USB总线虚拟仪器还具有许多优点，如可很好地满足工业测量的环境要求、可容易地实现完全的光电隔离、测量系统的改变和扩展非常方便、可带电拔插设备、完全的即插即用等，通过优化设计的组态软件还可实现自动组态。
　　USB总线测控系统主要也是利用USB总线的独特优点在USB虚拟仪器的基础上增加控制模块而实现的一种兼集中控制(ICS)和集散控制系统(DCS)优点于一体的测控系统。与基于PC总线的集中型控制系统相比，因USB总线中的控制模块是外挂式的，为了与USB总线相连，模块中必须有独立工作的CPU，因此，USB总线上的控制模块可设计成既可在主机(PC)的统一管理下协调工作，也可以脱离USB总线独立工作，这一点与DCS的特点是一样的，即不会因为主机或者通信总线的崩溃而导致控制系统瘫痪。因此，USB总线的测控系统的可靠性比PC工业总线系统更高。USB总线测控系统显然具有上述USB总线虚拟仪器的全部特点，而且系统构造的灵活性、所能达到的系统规模和程度、设备资源的可重复利用性和系统结构改变和重组的高效率及由此产生的效益是以往任何系统所不及的。
　　总之，PC机的使用已经超越了办公桌的范围，外设连接的瓶颈一旦被突破，它的影响力不是我们可以料想得到的。USB技术的实用带来的也许是一场PC机应用领域的革命。随着外设的日益丰富与消费电子产品的电脑化，PC机必将进入更为广阔的应用空间。
王省书（国防科学技术大学二系 长沙 410073）
秦石乔（国防科学技术大学二系 长沙 410073）
邵福球（国防科学技术大学二系 长沙 410073）
参考文献
1，秦石乔等. 微机接口技术和应用. 长沙：国防科技大学出版社, 1999.10
2，龙志宏. 连接的艺术. 中国计算机报, 1999年第15期
收稿日期：1999年8月16日
